from telegram.ext import ApplicationBuilder, MessageHandler, filters
from telegram.ext import ApplicationBuilder, MessageHandler, CommandHandler, filters
import random
import time

BOT_TOKEN = "8556098152:AAE988kjmkoL7TUHwsLu6xSoAbWtMXEp7MA"
START_TEXT = """Привет . Я бот от команды VV . Плохо понимаю в криптотерминах .

Основные ссылки:

Основной канал - @Pipromems

Основной чат - @liguemems

Hub 18+ - https://t.me/+jTET-PYrLekzMGMy

Чат $VSPACE - https://t.me/+k7PHJiaLbLVhOGZi

Приятного погружения в экосистему"""

# ================== СЛОВА-ТРИГГЕРЫ ==================

COMPLEX_WORDS = [
    # технологии / база
    "блокчейн", "api", "апи", "application", "апликейшн",
    "нода", "валидатор", "тестнет", "мейннет",
    "хешрейт", "хэш", "хэши",

    # pos / pow / dao / p2p
    "proof of stake", "proof of work", "pos", "pow",
    "dao", "дао",
    "p2p", "п2п",

    # defi / ликвидность
    "liquidity", "ликвидность", "ликвидити",
    "ликвид", "ликвидация", "ликвиднуло",
    "пул", "своп", "фарм", "фармить",
    "стейк", "стейкать", "стейкинг",
    "мост", "бридж", "бриджить",

    # рынок / трейдинг
    "памп", "пампить",
    "дамп", "дампить",
    "лонг", "лонговать",
    "шорт", "шортить", "шортил",
    "маржиналка", "плечо",
    "ордер", "стоп", "стоп-лосс",
    "тейк", "тейк-профит",
    "трейд", "трейдить",
    "скальпинг", "скальпить", "скальпировать",
    "сетка", "флэт", "боковик",
    "хай", "лоу",
    "отскок", "пролив", "перелив",
    "разворот", "вынос", "прострел",
    "перехай", "перелой",
    "просадка",

    # деривативы
    "спот", "фьючи", "фандинг",
    "ои", "открытый интерес",
    "экспирация", "контракты", "перп",

    # свечи / ТА
    "волатильность",
    "свеча", "тень", "хвост", "сопля",
    "доджи", "пинбар",
    "поглощение", "ложняк",
    "пробой", "закреп", "ретест",
    "перезаход",

    # hold / фиксация
    "холд", "холдер", "холдить",
    "фикс", "зафиксить",
    "перезайти", "усреднение", "лесенка",
    "откуп", "откупать", "подбор", "добор",
    "слив",

    # настроение рынка
    "фомо", "фад", "паникселл",
    "бычка", "медвежка",
    "бык", "медведь",
    "беариш",
    "капитуляция",

    # альты / капа
    "альта", "альты", "альтсезон",
    "биток", "эфир",
    "газ", "комса",
    "капа", "доминирование",

    # nft
    "nft", "нфтшка",
    "минт", "джипег",
    "флип", "флипать",
    "снайп", "снайпер",
    "флор", "флорный",

    # токеномика
    "токеномика",
    "эмиссия",
    "сжигание", "бёрн",
    "инфляция", "дефляция",
    "саплай", "циркул",
    "максималка", "флоат",
    "аллтаймхай", "аллтаймлоу",

    # иксы
    "икс", "два икса", "десять иксов",

    # airdrop / rewards / refs
    "airdrop", "аирдроп", "дроп",
    "ревард", "реварды", "ревардники",
    "реф", "рефка", "реферал", "рефнули", "рефнутый",
    "клейм", "вайтлист",

    # скам / безопасность
    "скам", "скамиться", "скам-проект",
    "раг", "рагпул",
    "фишинг", "фейк", "подделка", "клон",
    "сидка", "слив сидки",

    # манипуляции / игроки
    "манипул", "манипуля",
    "маркетмейкер",
    "киты",
    "ритейл", "ретейл",
    "смартмани",
    "объёмы", "влив", "вылив",

    # мемы / сленг
    "деген", "дегенить", "дегенада",
    "лудка", "лудик", "лудоман", "гембла",
    "хомяк",
    "шиток", "щиткоин",
    "гем",
    "луна", "ракета", "полёт",
    "туземун",
    "котлета", "на всю котлету",
    "деп", "депнуть",
    "качели",
    "засадить", "засадка",
    "стряхнули",
    "вынесли",

    # инфо / хайп
    "анонс", "анонсить",
    "апка", "аппка", "миниаппа",
    "апдейт", "патч", "релиз",
    "дорожная карта",
    "тимка", "анонимы",
    "паблик", "закрытый чат",
    "инсайд",
    "инфл", "инфлы", "инфлов", "инфла",
    "наратив", "нарратив",
    "хайп", "мета",
    "мемкоин",
    "собака", "лягушка",

    # otc / custody
    "otc",
    "кастодиал", "некастодиал",
    "ваучер", "инвайт", "гарант",

    # бритвы
    "брить", "бреют", "выбрить",
    "бритва", "побритый", "побрился",

    # гойский словарь
    "гой", "гои", "гойство"
]

# ================== ФРАЗЫ ОТВЕТА ==================

RANDOM_PHRASES = [
    "Бро, ты слишком сложно объясняешь — о чём вообще речь?",
    "Я что-то вообще не понял, можешь проще?",
    "Это сейчас на каком языке было?",
    "Ты меня потерял уже на середине сообщения.",
    "Переведи с умного на человеческий.",
    "Честно — ноль понимания.",
    "Я не улавливаю мысль, поясни.",
    "Слишком завуалировано, скажи прямо.",
    "Ты о чём конкретно?",
    "Много слов, а смысл где?",
    "Я не понял, к чему ты ведёшь.",
    "Можно для чайников?",
    "Звучит красиво, но непонятно.",
    "Объясни, будто мне 5 лет.",
    "Я читаю, но смысл не доходит.",
    "Что-то ты намудрил.",
    "Я выпал, повтори по-простому.",
    "Мы сейчас об одном и том же говорим?",
    "Слишком абстрактно, конкретнее можно?",
    "Я вообще не врубаюсь, если честно."
]

# ================== ЛОГИКА ==================

last_reply_time = {}

async def start_command(update, context):
    chat = update.effective_chat

    # Работаем только в личке
    if chat.type != "private":
        return

    await update.message.reply_text(START_TEXT)

async def handle_message(update, context):
    chat = update.effective_chat

    # Только группы
    if chat.type not in ["group", "supergroup"]:
        return

    text = update.message.text.lower()

    # Проверка на триггеры
    if not any(word in text for word in COMPLEX_WORDS):
        return

    chat_id = chat.id
    now = time.time()

    # Кулдаун 60 секунд
    if chat_id in last_reply_time:
        if now - last_reply_time[chat_id] < 60:
            return

    # Шанс ответа 70%
    if random.random() > 0.7:
        return

    await update.message.reply_text(random.choice(RANDOM_PHRASES))
    last_reply_time[chat_id] = now


# ================== ЗАПУСК ==================

app = ApplicationBuilder().token(BOT_TOKEN).build()

app.add_handler(CommandHandler("start", start_command))
app.add_handler(MessageHandler(filters.TEXT & ~filters.COMMAND, handle_message))

app.run_polling()